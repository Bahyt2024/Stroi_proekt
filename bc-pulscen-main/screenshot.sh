#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–∏—Å—Ç–µ–º—ã —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤
# –ê–≤—Ç–æ—Ä: AI Assistant
# –î–∞—Ç–∞: $(date +%Y-%m-%d)

echo "üöÄ –°–∏—Å—Ç–µ–º–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –¥–ª—è —Å–∞–π—Ç–∞"
echo "=================================="

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—â–µ–Ω –ª–∏ Python
if ! command -v python3 &> /dev/null; then
    echo "‚ùå Python3 –Ω–µ –Ω–∞–π–¥–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Python3."
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—â–µ–Ω –ª–∏ —Å–µ—Ä–≤–µ—Ä
echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞..."
if curl -s http://localhost:8000 > /dev/null 2>&1; then
    echo "‚úÖ –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω"
else
    echo "‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω"
    echo "üí° –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–Ω–∞—á–∞–ª–∞: python3 main.py"
    echo ""
    read -p "–•–æ—Ç–∏—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä —Å–µ–π—á–∞—Å? (y/n): " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        echo "üöÄ –ó–∞–ø—É—Å–∫–∞—é —Å–µ—Ä–≤–µ—Ä..."
        python3 main.py &
        SERVER_PID=$!
        echo "‚è≥ –ñ–¥–µ–º –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞..."
        sleep 5
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–Ω–æ–≤–∞
        if curl -s http://localhost:8000 > /dev/null 2>&1; then
            echo "‚úÖ –°–µ—Ä–≤–µ—Ä —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω (PID: $SERVER_PID)"
        else
            echo "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä"
            exit 1
        fi
    else
        exit 1
    fi
fi

echo ""
echo "–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º:"
echo "1. –ë—ã—Å—Ç—Ä—ã–π —Å–∫—Ä–∏–Ω—à–æ—Ç"
echo "2. –ü–æ–ª–Ω—ã–π —Å–∫—Ä–∏–ø—Ç —Å –≤—ã–±–æ—Ä–æ–º"
echo "3. –°–µ—Ä–∏—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ (–∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥)"
echo "4. –í—ã—Ö–æ–¥"

read -p "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä (1-4): " choice

case $choice in
    1)
        echo "üì∏ –ó–∞–ø—É—Å–∫–∞—é –±—ã—Å—Ç—Ä—ã–π —Å–∫—Ä–∏–Ω—à–æ—Ç..."
        python3 quick_screenshot.py
        ;;
    2)
        echo "üéØ –ó–∞–ø—É—Å–∫–∞—é –ø–æ–ª–Ω—ã–π —Å–∫—Ä–∏–ø—Ç..."
        python3 screenshot_system.py
        ;;
    3)
        echo "üîÑ –ó–∞–ø—É—Å–∫–∞—é —Å–µ—Ä–∏—é —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤..."
        read -p "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5): " count
        count=${count:-5}
        read -p "–ò–Ω—Ç–µ—Ä–≤–∞–ª –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30): " interval
        interval=${interval:-30}
        
        echo "üì∏ –°–æ–∑–¥–∞—é $count —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º $interval —Å–µ–∫—É–Ω–¥..."
        for i in $(seq 1 $count); do
            echo "üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç $i/$count..."
            python3 quick_screenshot.py > /dev/null 2>&1
            if [ $i -lt $count ]; then
                echo "‚è≥ –ñ–¥–µ–º $interval —Å–µ–∫—É–Ω–¥..."
                sleep $interval
            fi
        done
        echo "üéâ –í—Å–µ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã —Å–æ–∑–¥–∞–Ω—ã!"
        ;;
    4)
        echo "üëã –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!"
        exit 0
        ;;
    *)
        echo "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä"
        exit 1
        ;;
esac

echo ""
echo "üéØ –ì–æ—Ç–æ–≤–æ! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞–ø–∫—É 'system_screenshots'"

# –ï—Å–ª–∏ –º—ã –∑–∞–ø—É—Å–∫–∞–ª–∏ —Å–µ—Ä–≤–µ—Ä, —Å–ø—Ä–∞—à–∏–≤–∞–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –µ–≥–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
if [ ! -z "$SERVER_PID" ]; then
    echo ""
    read -p "–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä? (y/n): " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é —Å–µ—Ä–≤–µ—Ä..."
        kill $SERVER_PID
        echo "‚úÖ –°–µ—Ä–≤–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
    fi
fi 